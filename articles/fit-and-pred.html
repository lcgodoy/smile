<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • spmismo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="spmismo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spmismo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/fit-and-pred.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/sf-to-spm.html">1. Converting sf objects to spm</a>
    </li>
    <li>
      <a href="../articles/sp-cov-functions.html">2. Spatial covariance functions</a>
    </li>
    <li>
      <a href="../articles/theory.html">4. Theory</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lcgodoy/spmismo/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="fit-and-pred_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lcgodoy/spmismo/blob/master/vignettes/fit-and-pred.Rmd"><code>vignettes/fit-and-pred.Rmd</code></a></small>
      <div class="hidden name"><code>fit-and-pred.Rmd</code></div>

    </div>

    
    
<p>r— title: “3. Fitting models and making predictions” output: rmarkdown::html_vignette bibliography: biblio.bib vignette: &gt; % % % —</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lcgodoy.me/spmismo">spmismo</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="co">#&gt; Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 6.3.1</span></code></pre></div>
<p>If interested in the theory involving this calculations, take a look at this <a href="https://lcgodoy.me/spmismo/articles/theory.html">vignette</a>.</p>
<div id="application" class="section level1">
<h1 class="hasAnchor">
<a href="#application" class="anchor"></a>Application</h1>
<p>To exemplify the fitting and predicting functions, we are going to use the data from <span class="citation">@johnson2020dealing</span> again<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. First, in the code chunk below, we load the data and convert it to <code>spmismo</code> compatible classes. Since this is a toy example, we are going to generate a 500 points grid for the MSOA data and 5 points by polygon for the LSOA data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">liv_msoa</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">liv_lsoa</span><span class="op">)</span>

<span class="co">## workaround for compatibility with different PROJ versions</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">liv_msoa</span><span class="op">)</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">liv_msoa</span><span class="op">)</span><span class="op">$</span><span class="va">input</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">liv_lsoa</span><span class="op">)</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">liv_lsoa</span><span class="op">)</span><span class="op">$</span><span class="va">input</span>

<span class="co">## msoa to spm</span>
<span class="va">spm_msoa</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="../reference/sf_to_spm.html">sf_to_spm</a></span><span class="op">(</span>sf_obj1 <span class="op">=</span> <span class="va">liv_msoa</span>,
              n_pts   <span class="op">=</span> <span class="fl">500</span>,
              type    <span class="op">=</span> <span class="st">"regular"</span>,
              by_polygon <span class="op">=</span> <span class="cn">FALSE</span>,
              poly_ids <span class="op">=</span> <span class="st">"msoa11cd"</span>,
              var_ids  <span class="op">=</span> <span class="st">"leb_est"</span><span class="op">)</span>

<span class="co">## lsoa to spm</span>
<span class="va">spm_lsoa</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="../reference/sf_to_spm.html">sf_to_spm</a></span><span class="op">(</span>sf_obj1 <span class="op">=</span> <span class="va">liv_lsoa</span>,
              n_pts   <span class="op">=</span> <span class="fl">5</span>,
              type    <span class="op">=</span> <span class="st">"regular"</span>,
              by_polygon <span class="op">=</span> <span class="cn">TRUE</span>,
              poly_ids <span class="op">=</span> <span class="st">"lsoa11cd"</span>,
              var_ids  <span class="op">=</span> <span class="st">"imdscore"</span><span class="op">)</span></code></pre></div>
<p>The map below shows the LEB observed at the MSOAs.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">liv_msoa</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">leb_est</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="fit-and-pred_files/figure-html/leb-msoa1-1.png" width="700"></p>
<p>The map below displays the IMD observed at the LSOAs.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">liv_lsoa</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">imdscore</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="fit-and-pred_files/figure-html/imd-lsoa1-1.png" width="700"></p>
<div id="fit-at-msoa-prediction-at-lsoa" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-at-msoa-prediction-at-lsoa" class="anchor"></a>Fit at MSOA, prediction at LSOA</h2>
<p>Using as starting parameters <span class="math inline">\(\alpha = 70\)</span> (average of <span class="math inline">\(Y\)</span>), <span class="math inline">\(\omega = 1\)</span> (can be seen as a nugget effect), <span class="math inline">\(\sigma^2\)</span> (variance parameter for the powered exponential family), and <span class="math inline">\(\phi = 1\)</span> (paramter that controls the range os spatial dependence, 1 here represents 1_km_). We are going to compute the Maximum Likelihood estimates considering a Powered Exponential covariance function to the data, with <span class="math inline">\(\kappa = 1.5\)</span><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. Note that, it is important for this inputing vector to be a named vector, because some functions track the parameters by their names.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theta_st_msoa</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span> <span class="op">=</span> <span class="fl">70</span>, <span class="st">"omega"</span> <span class="op">=</span> <span class="fl">1</span>,
      <span class="st">"sigsq"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"phi"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">fit_msoa</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="../reference/fit_spm.html">fit_spm</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">spm_msoa</span>,
            theta_st <span class="op">=</span> <span class="va">theta_st_msoa</span>,
            model <span class="op">=</span> <span class="st">"pexp"</span>,
            kappa <span class="op">=</span> <span class="fl">1.5</span>,
            apply_exp <span class="op">=</span> <span class="cn">TRUE</span>,
            control   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>After a few seconds, we get the Results. Now, we can use the function <code>summary_sspm_fit</code> to get the summary of the results. The function prints a table containing the estimates, their standard errors, and <code>1 - sig</code> confidence interval based on the asymptotic normality of the MLEs. The function also prints a message indicating if the optimization algorithm has converged<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/summary_sspm_fit.html">summary_sspm_fit</a></span><span class="op">(</span><span class="va">fit_msoa</span>, sig <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  optimization algorithm converged: yes </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     par  estimate        se               ci</span>
<span class="co">#&gt; 1 alpha 75.897491 0.7067979 [74.512; 77.283]</span>
<span class="co">#&gt; 2 omega  7.924365 5.4567596 [-2.771; 18.619]</span>
<span class="co">#&gt; 3 sigsq  8.924365 0.5250597   [7.895; 9.953]</span>
<span class="co">#&gt; 4   phi  1.760340 0.1479164   [1.470; 2.050]</span></code></pre></div>
<p>Finally, now we are going to perform predictions of the LEB at the LSOA level. To do so, we use the function <code>predict_spm</code>. The <code>x</code> argument gives the sf on which we want to make the predictions according to the <code>sbm_obj</code>, which represents the estimated parameters. Now, take a look at the remaining arguments. The last two, are analogous to what we have seen for the function <code>sf_to_spm</code>. They are concerning the grid generated over the study region, now we going to make predicitons over this grid. I set it to 2500 to “approximate” a continuous region<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>. The argument <code>.aggregate</code> if set to <code>TRUE</code>, computes the predictions over the polygons from the input <code>x</code> (in this case <code>liv_lsoa</code>). This function also works if the input is a <code>sf</code> object with POINT geometries. The objects returned by the function <code>pred_lsoa</code> are lists with the following elements: 1) <code>mu_pred</code> - a vector with the predicted average for each location in the generated grid; 2) <code>sig_pred</code> the variance covariance matrix associated with the same grid; 3) the predictions (and standard errors) organized in an <code>sf</code> object to facilitate the visualization of the predictions over a (almost) continuous space; and 4) <code>pred_agg</code> which is returned only if we set <code>.aggregate = TRUE</code>. The last one contains the predictions and their standard erros integrated over the “new regions”.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_lsoa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_spm.html">predict_spm</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">liv_lsoa</span>, spm_obj <span class="op">=</span> <span class="va">fit_msoa</span>,
                         .aggregate <span class="op">=</span> <span class="cn">TRUE</span>, n_pts <span class="op">=</span> <span class="fl">2500</span>,
                         type <span class="op">=</span> <span class="st">"regular"</span><span class="op">)</span></code></pre></div>
<p>Now, let’s make some data manipulation to make the visualization look nicer. We are going to stack all the data to make it easier to plot them all together using ggplot2. The next map whos the predictions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aux_viz1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode   <span class="op">=</span> <span class="st">"list"</span>,
                   length <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>

<span class="va">aux_viz1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span><span class="va">pred_lsoa</span><span class="op">$</span><span class="va">pred_grid</span><span class="op">[</span><span class="st">"mu_pred"</span><span class="op">]</span>,
                           surface  <span class="op">=</span> <span class="st">"continuous"</span>,
                           variable <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">aux_viz1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"value"</span>
<span class="va">aux_viz1</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span><span class="va">pred_lsoa</span><span class="op">$</span><span class="va">pred_grid</span><span class="op">[</span><span class="st">"se_pred"</span><span class="op">]</span>,
                           surface  <span class="op">=</span> <span class="st">"continuous"</span>,
                           variable <span class="op">=</span> <span class="st">"se"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">aux_viz1</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"value"</span>
<span class="va">aux_viz1</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span><span class="va">pred_lsoa</span><span class="op">$</span><span class="va">pred_agg</span><span class="op">[</span><span class="st">"mu_pred"</span><span class="op">]</span>,
                           surface  <span class="op">=</span> <span class="st">"aggregated"</span>,
                           variable <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">aux_viz1</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"value"</span>
<span class="va">aux_viz1</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span><span class="va">pred_lsoa</span><span class="op">$</span><span class="va">pred_agg</span><span class="op">[</span><span class="st">"se_pred"</span><span class="op">]</span>,
                           surface  <span class="op">=</span> <span class="st">"aggregated"</span>,
                           variable <span class="op">=</span> <span class="st">"se"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">aux_viz1</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"value"</span>

<span class="va">aux_viz1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">aux_viz1</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aux_viz1</span><span class="op">[</span><span class="va">aux_viz1</span><span class="op">$</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"prediction"</span>,<span class="op">]</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill  <span class="op">=</span> <span class="va">value</span>,
           color <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">pred_lsoa</span><span class="op">$</span><span class="va">pred_agg</span><span class="op">)</span>, color <span class="op">=</span> <span class="fl">1</span>,
            lwd <span class="op">=</span> <span class="fl">.1</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">surface</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="fit-and-pred_files/figure-html/manip-pred-1-1.png" width="700"></p>
<p>The next one displays the standard errors for the predictions. Clearly, we have less variability in the neighborhoods on which we have small polygons.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aux_viz1</span><span class="op">[</span><span class="va">aux_viz1</span><span class="op">$</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"se"</span>,<span class="op">]</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill  <span class="op">=</span> <span class="va">value</span>,
           color <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">pred_lsoa</span><span class="op">$</span><span class="va">pred_agg</span><span class="op">)</span>, color <span class="op">=</span> <span class="fl">1</span>,
            lwd <span class="op">=</span> <span class="fl">.1</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">surface</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="fit-and-pred_files/figure-html/se-ggplot1-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">aux_viz1</span>, <span class="va">pred_lsoa</span>, <span class="va">fit_msoa</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/gc.html">gc</a></span><span class="op">(</span>full <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="fit-at-lsoa-predict-at-msoa" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-at-lsoa-predict-at-msoa" class="anchor"></a>Fit at LSOA, predict at MSOA</h2>
<p>Using as starting parameters <span class="math inline">\(\alpha = 25\)</span> (average of <span class="math inline">\(Y\)</span>), <span class="math inline">\(\omega = 1\)</span> (can be seen as a nugget effect), <span class="math inline">\(\sigma^2\)</span> (variance parameter for the powered exponential family), and <span class="math inline">\(\phi = 1\)</span> (paramter that controls the range os spatial dependence, 1 here represents 1_km_). We are going to compute the Maximum Likelihood estimates considering a Matern covariance function to the data, with <span class="math inline">\(\kappa = 2.5\)</span>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theta_st_lsoa</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span> <span class="op">=</span> <span class="fl">25</span>, <span class="st">"omega"</span> <span class="op">=</span> <span class="fl">1</span>,
      <span class="st">"sigsq"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"phi"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">fit_lsoa</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="../reference/fit_spm.html">fit_spm</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">spm_lsoa</span>,
            theta_st <span class="op">=</span> <span class="va">theta_st_lsoa</span>,
            model <span class="op">=</span> <span class="st">"matern"</span>,
            kappa <span class="op">=</span> <span class="fl">2.5</span>,
            apply_exp <span class="op">=</span> <span class="cn">TRUE</span>,
            control   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>After a few seconds, we get the Results. Now, we can use the function <code>summary_sspm_fit</code> again to summarise the estimated parameters.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/summary_sspm_fit.html">summary_sspm_fit</a></span><span class="op">(</span><span class="va">fit_lsoa</span>, sig <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  optimization algorithm converged: yes </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     par   estimate           se</span>
<span class="co">#&gt; 1 alpha  39.346894 2.955050e+01</span>
<span class="co">#&gt; 2 omega 367.215811 8.578584e+77</span>
<span class="co">#&gt; 3 sigsq 368.215811 2.891756e+00</span>
<span class="co">#&gt; 4   phi   1.708769 9.965613e-02</span>
<span class="co">#&gt;                                                                                                                                                                            ci</span>
<span class="co">#&gt; 1                                                                                                                                                           [-18.571; 97.265]</span>
<span class="co">#&gt; 2 [-1681371576065430380694774844776615085019998440658141800011837821504312049664000.000; 1681371576065430380694774844776615085019998440658141800011837821504312049664000.000]</span>
<span class="co">#&gt; 3                                                                                                                                                          [362.548; 373.884]</span>
<span class="co">#&gt; 4                                                                                                                                                              [1.513; 1.904]</span></code></pre></div>
<p>Now we are going to perform predictions of the IMD at the MSOA level. Since from now on the process is pretty much the exam, the explanation will be shorter.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_msoa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_spm.html">predict_spm</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">liv_msoa</span>, spm_obj <span class="op">=</span> <span class="va">fit_lsoa</span>,
                         .aggregate <span class="op">=</span> <span class="cn">TRUE</span>, n_pts <span class="op">=</span> <span class="fl">2500</span>,
                         type <span class="op">=</span> <span class="st">"regular"</span><span class="op">)</span></code></pre></div>
<p>Now, let’s make some data manipulation to again. Note that, the predictions for this variable have more</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aux_viz2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode   <span class="op">=</span> <span class="st">"list"</span>,
                   length <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>

<span class="va">aux_viz2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span><span class="va">pred_msoa</span><span class="op">$</span><span class="va">pred_grid</span><span class="op">[</span><span class="st">"mu_pred"</span><span class="op">]</span>,
                           surface  <span class="op">=</span> <span class="st">"continuous"</span>,
                           variable <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">aux_viz2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"value"</span>
<span class="va">aux_viz2</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span><span class="va">pred_msoa</span><span class="op">$</span><span class="va">pred_grid</span><span class="op">[</span><span class="st">"se_pred"</span><span class="op">]</span>,
                           surface  <span class="op">=</span> <span class="st">"continuous"</span>,
                           variable <span class="op">=</span> <span class="st">"se"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">aux_viz2</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"value"</span>
<span class="va">aux_viz2</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span><span class="va">pred_msoa</span><span class="op">$</span><span class="va">pred_agg</span><span class="op">[</span><span class="st">"mu_pred"</span><span class="op">]</span>,
                           surface  <span class="op">=</span> <span class="st">"aggregated"</span>,
                           variable <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">aux_viz2</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"value"</span>
<span class="va">aux_viz2</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span><span class="va">pred_msoa</span><span class="op">$</span><span class="va">pred_agg</span><span class="op">[</span><span class="st">"se_pred"</span><span class="op">]</span>,
                           surface  <span class="op">=</span> <span class="st">"aggregated"</span>,
                           variable <span class="op">=</span> <span class="st">"se"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">aux_viz2</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"value"</span>

<span class="va">aux_viz2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">aux_viz2</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aux_viz2</span><span class="op">[</span><span class="va">aux_viz2</span><span class="op">$</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"prediction"</span>,<span class="op">]</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill  <span class="op">=</span> <span class="va">value</span>,
           color <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">pred_msoa</span><span class="op">$</span><span class="va">pred_agg</span><span class="op">)</span>, color <span class="op">=</span> <span class="fl">1</span>,
            lwd <span class="op">=</span> <span class="fl">.1</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">surface</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="fit-and-pred_files/figure-html/manip-pred-2-1.png" width="700"></p>
<p>The next one displays the standard errors for the predictions.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aux_viz2</span><span class="op">[</span><span class="va">aux_viz2</span><span class="op">$</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"se"</span>,<span class="op">]</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill  <span class="op">=</span> <span class="va">value</span>,
           color <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">pred_msoa</span><span class="op">$</span><span class="va">pred_agg</span><span class="op">)</span>, color <span class="op">=</span> <span class="fl">1</span>,
            lwd <span class="op">=</span> <span class="fl">.1</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">surface</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="fit-and-pred_files/figure-html/se-ggplot2-1.png" width="700"></p>
</div>
<div id="joint-model" class="section level2">
<h2 class="hasAnchor">
<a href="#joint-model" class="anchor"></a>“Joint” model</h2>
<p>For more details see this <a href="lcgodoy.me/spmismo/theory.html">link</a>.</p>
<p>No we are going to model the two variables together. Besides an additional variance parameter, for this model we have an additional intercept and a <span class="math inline">\(\beta\)</span> parameter that measures how associated the two variables are (at the continuous process scale). First, we create a <code>spm</code> object contaning the info about both variables, as described in this <a href="lcgodoy.me/spmismo/theory.html">vignette</a>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## joint spm object</span>
<span class="va">spm_xy</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="../reference/sf_to_spm.html">sf_to_spm</a></span><span class="op">(</span>sf_obj1 <span class="op">=</span> <span class="va">liv_msoa</span>,
              sf_obj2 <span class="op">=</span> <span class="va">liv_lsoa</span>,
              n_pts   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">5</span><span class="op">)</span>,
              type    <span class="op">=</span> <span class="st">"regular"</span>,
              by_polygon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span>,
              poly_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"msoa11cd"</span>, <span class="st">"lsoa11cd"</span><span class="op">)</span>,
              var_ids  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"leb_est"</span>, <span class="st">"imdscore"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now, we can fit the model using the same <code>fit_spm</code> function. Here, we are using the Exponential covariance function. Also, pay attention the the different starting parameters forthe vector <code>theta_xy</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theta_xy</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span> <span class="op">=</span> <span class="fl">60</span>, <span class="st">"beta"</span> <span class="op">=</span> <span class="fl">2</span>,
      <span class="st">"gamma"</span> <span class="op">=</span> <span class="fl">30</span>, <span class="st">"omega"</span> <span class="op">=</span> <span class="fl">10</span>,
      <span class="st">"sigsq"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"phi"</span> <span class="op">=</span> <span class="fl">3</span>,
      <span class="st">"nusq"</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="va">fit_xy</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="../reference/fit_spm.html">fit_spm</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">spm_xy</span>,
            theta_st  <span class="op">=</span> <span class="va">theta_xy</span>,
            model <span class="op">=</span> <span class="st">"matern"</span>,
            kappa <span class="op">=</span> <span class="fl">.5</span>,
            apply_exp <span class="op">=</span> <span class="cn">TRUE</span>,
            control   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now, we use the same summary function to verify the results as follows.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/summary_sspm_fit.html">summary_sspm_fit</a></span><span class="op">(</span><span class="va">fit_xy</span>, sig <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span></code></pre></div>
<p>Note that, for this scenario the optimization algorithm has not converged. For this reason, I set, temporarily, the <code>eval</code> option to <code>FALSE</code> for the three last chunks of code.</p>
<p>This needs to be further investigated.</p>
<blockquote>
<p>P.S.: For all estimation problems we have used the parameter <code>apply_exp = TRUE</code>, which implies that the parameters that cannot assume negative values have to be exponentiated. This makes the optimization process easier. The only care that we need to take is that we need to use the Delta Method to Transform the Information Matrix accordingly.</p>
</blockquote>
</div>
</div>
<div id="reference" class="section level1">
<h1 class="hasAnchor">
<a href="#reference" class="anchor"></a>Reference</h1>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>for more details about the data, take a look at the vignette <a href="https://lcgodoy.me/spmismo/articles/sf-to-spm.html">sf-to-spm</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>This parameter is known to be hard to be estimated in the literature of geostatistics.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>The default algorithm used by the package is the Nelder-Mead, this can easily be changed by setting the parameter <code>opt_method = "L-BFGS-B"</code>, for example.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Be careful here, a very large number of points can result in intractable covariance matrices<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lucas Godoy.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
